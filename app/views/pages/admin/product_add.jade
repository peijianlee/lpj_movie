extends ../../layout_admin

block content
	.admin_wrap
		h2.pageheader
			i.icon-magnet
			| #{title}
		.button-group.pl20.pt20
			button.button.button-royal.button-rounded.button-raised.button-small(type="button") 基本信息
			button.button.button-rounded.button-raised.button-small(type="button") 图片管理
			button.button.button-rounded.button-raised.button-small(type="button") 商品详情
		.contentpanel
			form.form_horizontal(method="post", action="/admin/product", enctype="multipart/form-data")
				if product._id
					input(type="hidden", name="product[_id]", value=product._id)
				.form_group
					label.control_label 商品名称：
					.control_div
						input(type="text", name="product[title]",placeholder="请输入文章标题", value=product.title)
				.form_group
					label.control_label 分类选择：
					#radio_list.control_div
						each cat in categories
							label(style="margin:0 15px 0 5px;cursor: pointer;")
								if product._id
									input.category(type="radio", name="product[category]", value=cat._id, checked=cat._id.toString()==product.category.toString())
									| #{cat.name}
								else
									input(type="radio", name="product[category]", value=cat._id)
									| #{cat.name}
				.form_group
					label.control_label 商品尺寸：
					.control_div.product_size_input
						if product._id
							label 长
							input(type="text", name="product[size].h", value=product.size.h)
							label *
							label 宽
							input(type="text", name="product[size].w", value=product.size.w)
							label *
							label 高
							input(type="text", name="product[size].d", value=product.size.d)
							label (CM)
						else
							label 长
							input(type="text", name="product[size].h")
							label *
							label 宽
							input(type="text", name="product[size].w")
							label *
							label 高
							input(type="text", name="product[size].d")
							label (CM)

				.form_group
					label.control_label 销售价格：
					.control_div
						input(style="width:150px;", type="text", name="product[price]",placeholder="请输入价格", value=product.price)
				//- .form_group
					input#productContent(type="hidden", name="product[content]",value=product.content)
					script(type="text/javascript",src="/libs/ueditor/ueditor.config.js")
					script(type="text/javascript",src="/libs/ueditor/ueditor.all.min.js")
					script(type="text/javascript",src="/libs/ueditor/lang/en/en.js")
					script#editor(type="text/plain",style="width:100%;height:500px;")

				.form_group
					.col-sm-offset-1.col-sm-1
						if product._id
							button#btn_save.button.button-primary.button-primary.button-longshadow-right(type="sumbit")
								b.icon-upload
								&nbsp;&nbsp;更 新
						else
							button#btn_save.button.button-primary.button-primary.button-longshadow-right(type="sumbit")
								b.icon-hdd
								&nbsp;&nbsp;录 入
				input(type="hidden", name="product[uid]", value="#{user._id}")
		//- script.
			//实例化编辑器
			//建议使用工厂方法getEditor创建和引用编辑器实例，如果在某个闭包下引用该编辑器，直接调用UE.getEditor('editor')就能拿到相关的实例
			var ue = UE.getEditor('editor'),
				productContent;

			$(function(){
				var content = $('#productContent').val();
				//判断ueditor 编辑器是否创建成功
				ue.addListener("ready", function () {
					// editor准备好之后才可以使用
					ue.setContent(content);
				
				});
			});
			function getContent() {
				var arr = [];
				//- arr.push("使用editor.getContent()方法可以获得编辑器的内容");
				//- arr.push("内容为：");
				arr.push(UE.getEditor('editor').getContent());
				productContent = arr.join("\n");
			}

			//- 录入按键
			var btn_save = document.getElementById('btn_save')
			var productTitleInput = document.getElementById('productTitle')
			var productContentInput = document.getElementById('productContent')

			btn_save.onclick = function(){
				findRadioChecked()
				if(radioChecked==false){
					artalert('请选择文章分类')
					return false;
				}
				var productTitle = productTitleInput.value;
				if(productTitle.replace(/\s/g, "")===''){
					artalert('标题不能为空，或空格符')
					return false;
				}
				getContent();
				productContentInput.value = productContent;
			};

			//- 判断分类是否有选择
			var input_radio = document.getElementsByName('product[category]')
			var radioChecked = false;
			function findRadioChecked(){
				for(var i=0;i<input_radio.length;i++){
					if(input_radio.item(i).checked){
						radioChecked = true;
						return false;
					}
				}
			}


