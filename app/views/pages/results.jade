extends ../layout_index

block content
		link(href="/css/product.css",rel="stylesheet")
		//- if attributes && attributes.length > 0
			.wrap.sarch_nav
				for type in attributes
					dl.search_nav_type
						dt #{type.cnname}：
						dd
							- if(href){
							- 	if(href.indexOf(type.name) > -1){
							-		var pattern = type.name+'=([^&]*)'
							-		var tmp = '/('+type.name+'=)([^&]*)/gi'
							-		var allhref = href.replace(eval(tmp), '')
							-		if(allhref.charAt(allhref.length-1)==='&'){
							-			var allhref = allhref.substring(0,allhref.length-1)
							-		}else if(allhref.charAt(1)==='&'){
							-			var allhref = '?'+allhref.substring(2)
							-		}else if(allhref.toString()==='?'){
							-			var allhref = '/store/sort/'+category.attributes
							- 		}
							- 	}else{
							-		if(href.charAt(href.length-1)==='?'){
							-			var allhref = href.substring(0,href.length-1)
							-		}else{
							-			var allhref = href
							-		}
							- 	}
							- }else{
							-	var allhref = '/store/sort/'+category.attributes
							- }
							a(href=allhref) 全部
							if type.attributes && type.attributes.length > 0
								each item in type.attributes
									if sort == item.id || scene == item.id || material == item.id || color == item.id
										a.On(href=ahref) #{item.attributes}
									else
										a(href=ahref) #{item.attributes}
		if allCategoryType && allCategoryType.length > 0
			.wrap.sarch_nav
				each type in allCategoryType
					dl.search_nav_type
						dt #{type.name}
						dd
							- if(href){
							- 	if(href.indexOf(type.name) > -1){
							-		var pattern = type.name+'=([^&]*)'
							-		var tmp = '/('+type.name+'=)([^&]*)/gi'
							-		var allhref = href.replace(eval(tmp), '')
							-		if(allhref.charAt(allhref.length-1)==='&'){
							-			var allhref = allhref.substring(0,allhref.length-1)
							-		}else if(allhref.charAt(1)==='&'){
							-			var allhref = '?'+allhref.substring(2)
							-		}else if(allhref.toString()==='?'){
							-			var allhref = '/store/sort/'+category.attributes
							- 		}
							- 	}else{
							-		if(href.charAt(href.length-1)==='?'){
							-			var allhref = href.substring(0,href.length-1)
							-		}else{
							-			var allhref = href
							-		}
							- 	}
							- }else{
							-	var allhref = '/store/sort/'+category.attributes
							- }
							a(href=allhref) 全部
							each cid in type.cid
								- if(href){
								- 	if(href.indexOf(type.name) > -1){
								-		var pattern = type.name+'=([^&]*)'
								-		var replaceText = type.name+'='+cid.id
								-		var tmp = '/('+type.name+'=)([^&]*)/gi'
								-		var ahref = href.replace(eval(tmp), replaceText)
								- 	}else{
								-		var ahref = href+'&'+type.name+'='+cid.id
								- 	}
								- }else{
								-	var ahref = '?'+type.name+'='+cid.id
								- }
								- if(href.indexOf(cid.id) > -1)
									a.On(href=ahref) #{cid.attributes}
								- else
									a(href=ahref) #{cid.attributes}									

		.search_word_tip.wrap.mt10
			i.icon-search.mr10.ml10
			| !{keyword}
		.wrap.iproduct_list
			.category_list
			.sub_product_frame_row4
				if products && products.length > 0
					each item in products
						.sub_page_product(id=item.id)
							img(src='/images_data/p'+item.id+'/'+item.cover)
							.ip_bg
							ul.ip_description
								li
									a(href="/store/"+item.sort.name+"/"+item.id).ip_title
										|#{item.title}
										if item.material && item.material.length > 0
											|&nbsp;#{item.material[0].attributes}
										else
											|&nbsp;未知材料
										|&nbsp;宽#{item.size.w}×深#{item.size.d}×高#{item.size.h}cm
										if item.color && item.color.length > 0
											|&nbsp;/ #{item.color[0].attributes}
										else
											|&nbsp;/ 未知颜色
								li
									if item.sale
										span.ip_tag 特价商品
									if (moment(item.meta.createAt).add('hour',8).fromNow()).indexOf('ago')<0
										span.ip_tag 新品
								li
									- if(cart_goods.indexOf(item.id) > -1){
									-	var btnClass = 'iproduct_add_cart_btn Stand'
									- }else{
									-	var btnClass = 'iproduct_add_cart_btn'
									- }
									span(class="#{btnClass} cp animation")
										i.icon-shopping-cart
										input(type="hidden",name="p[id]",value=item.id)
										input(type="hidden",name="p[quantity]",value="1")
									if item.sale
										small.ip_price ￥#{item.sale}.00
										small.ip_old_price ￥#{item.price}.00
									else
										small.ip_price ￥#{item.price}.00
				else
					.col-md-2 没有任何数据！
			
			.page(style="margin-top:15px;margin-bottom:30px;")
				- if(totalPage>1){
					- if(currentPage-1 == 0){
							span.page_unclick: i.icon-double-angle-left
							span.page_unclick: i.icon-angle-left
					-	}else{
							a(href=pagehref+'?q='+searchword+'&p=0',csstip-top='第一页'): i.icon-double-angle-left
							a(href=pagehref+'?q='+searchword+'&p=#{currentPage-1}',csstip-top='上一页'): i.icon-angle-left
					-	}
					-	for(var i=0;i<totalPage; i++){
						-	if(currentPage == (i+1)){
								span.page_stand #{currentPage}
						-	}else{
								a(href=pagehref+'?q='+searchword+'&p=#{i}') #{i+1}
						-	}
					-	}
					- if(currentPage < totalPage){
							a(href=pagehref+'?q='+searchword+'&p=#{currentPage}',csstip-top='下一页'): i.icon-angle-right
							a(href=pagehref+'?q='+searchword+'&p=#{totalPage-1}',csstip-top='最后一页'): i.icon-double-angle-right
					-	}else{
							span.page_unclick: i.icon-angle-right
							span.page_unclick: i.icon-double-angle-right
					-	}
				- }
		.bg_fixed
		script(src="/js/shopcart.js")