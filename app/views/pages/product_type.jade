extends ../layout_index

block content
	link(href="/css/product.css",rel="stylesheet")
	if products && products.length > 0
		.wrap.nav
			a(href="/news")
				i.fs14.icon-home
			a(href="/store") store
			span #{linkSort}
			b #{category.attributes}
		if category.banner
			div.goodsSortBg.wrap(style="background-image:url(/banner/#{category.banner})")
		if categories && categories.length > 0
			.wrap.mt15
				dl.type_side_nav
					dt
						i.icon-magnet.mr10
						| 商品分类
					each cats in categories
						dd
							if cats.id.toString() === category.id.toString()
								a.animation.On(href="/store/#{linkSort}/#{cats.attributes}")
									i.icon-angle-right.mr10
									| #{cats.attributes}
							else
								a.animation(href="/store/#{linkSort}/#{cats.attributes}")
									i.icon-angle-right.mr10
									| #{cats.attributes}
				div.goodsSort
					if category.description
						.goodsSortHead
							h2: span #{category.attributes}
							div.goodsSortDescription !{category.description}
					if allCategoryType && allCategoryType.length > 0
						if(href)
							.search_nav_topline
							each type in allCategoryType
								if type.name.toString() !== linkSort.toString()
									dl.search_nav_type
										dt #{type.name}
										dd
											- if(href){
											- 	if(href.indexOf(type.name) > -1){
											-		var pattern = type.name+'=([^&]*)'
											-		var tmp = '/('+type.name+'=)([^&]*)/gi'
											-		var allhref = href.replace(eval(tmp), '')
											-		if(allhref.charAt(allhref.length-1)==='&'){
											-			var allhref = allhref.substring(0,allhref.length-1)
											-		}else if(allhref.charAt(1)==='&'){
											-			var allhref = '?'+allhref.substring(2)
											-		}else if(allhref.toString()==='?'){
											-			var allhref = '/store/sort/'+category.attributes
											- 		}
											- 	}else{
											-		if(href.charAt(href.length-1)==='?'){
											-			var allhref = href.substring(0,href.length-1)
											-		}else{
											-			var allhref = href
											-		}
											- 	}
											- }else{
											-	var allhref = '/store/sort/'+category.attributes
											- }
											a(href=allhref) 全部
											each cid in type.cid
												- if(href){
												- 	if(href.indexOf(type.name) > -1){
												-		var pattern = type.name+'=([^&]*)'
												-		var replaceText = type.name+'='+cid.id
												-		var tmp = '/('+type.name+'=)([^&]*)/gi'
												-		var ahref = href.replace(eval(tmp), replaceText)
												- 	}else{
												-		var ahref = href+'&'+type.name+'='+cid.id
												- 	}
												- }else{
												-	var ahref = '?'+type.name+'='+cid.id
												- }
												- if(href && href.indexOf(cid.id) > -1)
													a.On(href=ahref) #{cid.attributes}
												- else
													a(href=ahref) #{cid.attributes}
					.sub_product_frame_row3
						each item in products
							.sub_page_product.pr(id=item.id)
								//- span.my_favourite.pa
									i.icon-heart-empty
									i.icon-heart.animation
								img(src='/images_data/'+item.id+'/'+item.cover)
								div.ip_bg
								ul.ip_description
									li
										a(href="/store/id/"+item.id).ip_title
											|#{item.title}
											if item.material && item.material.length > 0
												|&nbsp;/ #{item.material[0].attributes}
											if item.color && item.color.length > 0
												|&nbsp;/ #{item.color[0].attributes}
									li.pb5 宽#{item.size.w}×深#{item.size.d}×高#{item.size.h}cm
									li.pb5
										if item.sale
											span.ip_tag 特价商品
										if (moment(item.meta.createAt).add('hour',8).fromNow()).indexOf('ago')<0
											span.ip_tag 新品
									li
										span.iproduct_add_cart_btn.cp
											i.icon-shopping-cart
											input(type="hidden",name="p[id]",value=item.id)
											input(type="hidden",name="p[quantity]",value="1")
										if item.sale
											small.ip_price ￥#{item.sale}.00
											small.ip_old_price ￥#{item.price}.00
										else
											small.ip_price ￥#{item.price}.00
	.bg_fixed
	script(src="/js/shopcart.js")